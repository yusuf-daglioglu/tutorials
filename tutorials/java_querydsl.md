# JAVA QUERY DSL

IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII

IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII

## ğŸ“Œ QueryDSL

build sÄ±rasÄ±nda code generation'Ä± yaparak, birÃ§ok `Java` kÃ¼tÃ¼phanesi iÃ§in ek query saÄŸlayan kÃ¼tÃ¼phanedir. desteklediÄŸi kÃ¼tÃ¼phaneler:

- `JPA`
- `SQL`
- `MongoDB`
- `Java` built-in `Collections`

`JPA` iÃ§in Ã¶rnek olarak kullanÄ±mÄ±na bakalÄ±m:

```xml
<dependencies>

    <dependency>
        <!-- this is for code generation on build time. so it is on provided scope which means this library exist only on build phase. -->
        <groupId>com.querydsl</groupId>
        <artifactId>querydsl-apt</artifactId>
        <version>${querydsl.version}</version>
        <scope>provided</scope>
    </dependency>

    <dependency>
        <!-- burada kullanmak istediÄŸimiz Java modÃ¼lÃ¼nÃ¼ eklememiz ÅŸart -->
        <groupId>com.querydsl</groupId>
        <artifactId>querydsl-jpa</artifactId>
        <version>${querydsl.version}</version>
    </dependency>

</dependencies>

<plugin>
    <!-- this is for code generation on build time. -->
    <artifactId>apt-maven-plugin</artifactId>
    <version>1.1.3</version>
    <executions>
        <execution>
            <goals>
                <goal>process</goal>
            </goals>
            <configuration>
                <outputDirectory>target/generated-sources/java</outputDirectory>
                <processor>com.querydsl.apt.jpa.JPAAnnotationProcessor</processor>
            </configuration>
        </execution>
    </executions>
</plugin>
```

`Java` kodumuzda `User` isimli bir `entity` varsa; `mvn compile` komutunu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±mÄ±zda `QUser` isimli bir sÄ±nÄ±f generate edilecektir. `QUser` iÃ§erisinde birÃ§ok query yapabilmemizi saÄŸlayan metot mevcuttur. Ã¶rnek kullanÄ±m:

```java
EntityManagerFactory emf = Persistence.createEntityManagerFactory(); // default JPA class
EntityManager em = emf.createEntityManager(); // default JPA class

JPAQueryFactory queryFactory = new JPAQueryFactory(em); // com.querydsl.jpa.impl.JPAQueryFactory

QUser user = QUser.user; // QUser is auto-generated by QueryDSL library. QUser includes a default instance of QUser as static.

// simple get example
User c = queryFactory.selectFrom(user)
                              .where(user.login.eq("David"))
                              .fetchOne();

// order example
List<User> c = queryFactory.selectFrom(user)
                                  .orderBy(user.login.asc())
                                  .fetch();

// update example
queryFactory.update(user)
  .where(user.login.eq("Ash"))
  .set(user.login, "Ash2")
  .set(user.disabled, true)
  .execute();

// delete example
queryFactory.delete(user)
  .where(user.login.eq("David"))
  .execute();
```

## ğŸ“Œ Predicate

`Predicate` kelime anlamÄ±: yÃ¼klem, doÄŸrulamak, belirtmek.

kelime kÃ¶kÃ¼ `predict`'ten (Ã¶ngÃ¶rmek) gelmiyor. tamamen farklÄ± kelimelerdir.

Bilgisayar ve matematik bilimlerinde `Predicate` filtre yapÄ±ldÄ±ÄŸÄ±nda uygulanacak kriterin tutulduÄŸu instance/obje'ye verilen isimdir. `Predicate`, en basit Ã¶rnek olarak aÅŸaÄŸÄ±daki `Java` kodu ile Ã¶rneklenmiÅŸtir. aÅŸaÄŸÄ±daki filter metodu `java.util.function.Predicate<T>` (`Functional Interface`) sÄ±nÄ±fÄ±nÄ± argÃ¼man olarak kabul eder.

```java
List<Integer> list = Arrays.asList(1, 2, 3, 4, 5);

List<Integer> collect = list.stream().filter(x -> x > 3).collect(Collectors.toList());
```

`java.util.function.Predicate`'in kodu bu ÅŸekildedir:

Not: aÅŸaÄŸÄ±daki koddaki yorumlara bakÄ±ldÄ±ÄŸÄ±nda ÅŸu yorum Ã§ok Ã¶nemli:

```text
"predicate (boolean-valued function) of one argument."
```

```java
import java.util.Objects;

/**
 * Represents a predicate (boolean-valued function) of one argument.
 */
@FunctionalInterface
public interface Predicate<T> {

    /**
     * Evaluates this predicate on the given argument.
     *
     * @param t the input argument
     * @return {@code true} if the input argument matches the predicate,
     * otherwise {@code false}
     */
    boolean test(T t);

    /**
     Other code here!
     http://hg.openjdk.java.net/jdk8/jdk8/JDK/file/687fd7c7986d/src/share/classes/java/util/function/Predicate.java
     */
}
```

## ğŸ“Œ QueryDSL Predicate

Ã¶rnek:

```java
import org.springframework.data.querydsl.binding.QuerydslPredicate;
import com.querydsl.core.types.Predicate;

@GetMapping(value = "/users")
public Page<UserDto> fetchUsers(
                               @QuerydslPredicate(root = UserDBEntity.class) Predicate predicate,

                               // "pageable" baÅŸka baÅŸlÄ±kta anlatÄ±lÄ±yor. bu konudan baÄŸÄ±msÄ±z. burada sadece birlikte kullanÄ±labileceÄŸini gÃ¶stermeye Ã§alÄ±ÅŸtÄ±m. pageable'Ä±n konulmasÄ± zorunlu deÄŸil.
                               Pageable pageable
                               ) {

    // repository should extends org.springframework.data.querydsl.QuerydslPredicateExecutor<UserDBEntity>
    Page<User> userListPageable = userRepository.findAll(predicate, pageable);

    // mpToDto QueryDSL'den baÄŸÄ±msÄ±z bir konu. DB entity'sini dÃ¶nmemek iÃ§in burada basit bir mapping yapÄ±ldÄ±.
    return userListPageable.map(UserDBEntity -> mapperUtil.mapToDto(UserDBEntity));
}
```

`@QuerydslPredicate` direk query'nin parametre olarak inject edilmesini saÄŸlÄ±yor. AynÄ± `Pageable`'Ä±n yaptÄ±ÄŸÄ± gibi.

```java
// com.querydsl.core.types.dsl.BooleanExpression
BooleanExpression b = QUser.user.email.eq("ahmet@gmail.com");
```

`BooleanExpression` implements `com.querydsl.core.types.Predicate` interface.
